

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FF6B35">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Reportes Foto">
    
    <title>Reportes Fotogr√°ficos Pro v3.0</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA2ElEQVRYhe2XMQ6DMAxFn5ArgBQxMnSH3oCla8/AFTgCd+hSiZGlK0tXxAEQQ0tCCKQkTfqltCqJ9f6zHduAv18JGAEr4Ai8gDvQBXrAGJgDM2AC9IF7nPuNbIEzcAFu8TkDS2AFbGPtCixibQ8c4rwPMkMKQFevc56vY9IAyZmiBqRnSgqQnikqQAFTVABnU1SAHqbUBZjClLoAjSkuQGWKC+BlSl0AK1PqAqxN6RigNaVjACtTOga4NP4RoFl+1p88vxp/BdAs3+R59NriHUARQHMj/nz+fjN+AMMYSo0a8/WjAAAAAElFTkSuQmCC">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Pantalla de Inicio -->
    <div id="homeScreen" class="screen active">
        <div class="header">
            <h1>üì∏ Reportes Fotogr√°ficos</h1>
            <button class="btn-icon-header" onclick="showSettings()">‚öôÔ∏è</button>
        </div>
        
        <div class="content">
            <div class="welcome-message">
                <h2>Bienvenido</h2>
                <p>Crea reportes profesionales con hasta 12 fotos por p√°gina</p>
            </div>
            
            <!-- Barra de b√∫squeda -->
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="üîç Buscar reportes..." oninput="searchReports()">
            </div>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" id="totalReports">0</div>
                    <div class="stat-label">Reportes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalPhotos">0</div>
                    <div class="stat-label">Fotos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="storageUsed">0 MB</div>
                    <div class="stat-label">Almacenamiento</div>
                </div>
            </div>
            
            <button class="btn-primary" onclick="showNewReport()">
                <span class="btn-icon">‚ûï</span>
                Crear Nuevo Reporte
            </button>
            
            <div class="reports-list" id="reportsList">
                <div class="reports-header">
                    <h3>Reportes Guardados</h3>
                    <select id="sortSelect" onchange="sortReports()" class="sort-select">
                        <option value="newest">M√°s recientes</option>
                        <option value="oldest">M√°s antiguos</option>
                        <option value="name">Por nombre</option>
                        <option value="photos">M√°s fotos</option>
                    </select>
                </div>
                <div id="reportsContainer"></div>
            </div>
        </div>
    </div>

    <!-- Pantalla de Nuevo Reporte -->
    <div id="newReportScreen" class="screen">
        <div class="header">
            <button class="btn-back" onclick="showHome()">‚Üê Atr√°s</button>
            <h1 id="reportTitle">Reporte 1</h1>
            <button class="btn-icon-header" onclick="showMenu()">‚ãÆ</button>
        </div>
        
        <div class="content">
            <div class="toolbar">
                <button class="toolbar-btn" onclick="document.getElementById('cameraInput').click()">
                    <span class="icon">üì∑</span>
                    <span>C√°mara</span>
                </button>
                <button class="toolbar-btn" onclick="document.getElementById('galleryInput').click()">
                    <span class="icon">üñºÔ∏è</span>
                    <span>Galer√≠a</span>
                </button>
                <button class="toolbar-btn" onclick="addTextNote()">
                    <span class="icon">üìù</span>
                    <span>Nota</span>
                </button>
                <button class="toolbar-btn" onclick="generatePDF()">
                    <span class="icon">üìÑ</span>
                    <span>PDF</span>
                </button>
            </div>
            
            <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;" onchange="handleImageUpload(event)">
            <input type="file" id="galleryInput" accept="image/*" multiple style="display: none;" onchange="handleImageUpload(event)">
            
            <!-- √Årea de Drop -->
            <div class="drop-zone" id="dropZone">
                <div class="drop-zone-content">
                    <span class="drop-icon">üìÅ</span>
                    <p>Arrastra fotos aqu√≠</p>
                    <p class="drop-subtitle">Hasta 12 fotos por p√°gina</p>
                </div>
            </div>
            
            <div class="photos-grid" id="photosGrid">
                <div class="empty-state">
                    <div class="empty-icon">üì∏</div>
                    <p>No hay fotos a√∫n</p>
                    <p class="empty-subtitle">Agrega fotos desde la c√°mara, galer√≠a o arrastra aqu√≠</p>
                </div>
            </div>
            
            <div class="photo-counter">
                <span id="currentPhoto">0</span>/12 fotos ‚Ä¢ P√°gina <span id="currentPageNum">1</span>
            </div>
        </div>
    </div>

    <!-- Modal de Foto -->
    <div id="photoModal" class="modal">
        <div class="modal-content photo-modal-content">
            <div class="modal-header">
                <button class="btn-close" onclick="closePhotoModal()">‚úï</button>
                <button class="btn-icon-header" onclick="toggleZoom()">üîç</button>
            </div>
            <div class="photo-viewer" id="photoViewer">
                <img id="modalImage" src="" alt="Foto">
            </div>
            <textarea id="photoNote" class="photo-note-input" placeholder="Agregar nota a esta foto..." maxlength="500"></textarea>
            <div class="note-counter"><span id="noteLength">0</span>/500 caracteres</div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="deleteCurrentPhoto()">üóëÔ∏è Eliminar</button>
                <button class="btn-primary" onclick="savePhotoNote()">üíæ Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Men√∫ MEJORADO -->
    <div id="menuModal" class="modal">
        <div class="modal-content menu-modal">
            <button class="menu-item" onclick="editReportTitle()">
                <span class="menu-icon">‚úèÔ∏è</span>
                <span>T√≠tulo</span>
            </button>
            <button class="menu-item" onclick="uploadLogo()">
                <span class="menu-icon">üñºÔ∏è</span>
                <span>Cambiar Logo</span>
            </button>
            <button class="menu-item" onclick="editBottomText()">
                <span class="menu-icon">üìù</span>
                <span>Texto inferior</span>
            </button>
            <button class="menu-item" onclick="showSizesModal()">
                <span class="menu-icon">üî§</span>
                <span>Tama√±os</span>
            </button>
            <button class="menu-item" onclick="duplicateReport()">
                <span class="menu-icon">üìã</span>
                <span>Duplicar Reporte</span>
            </button>
            <button class="menu-item" onclick="exportReport()">
                <span class="menu-icon">üíæ</span>
                <span>Exportar Datos</span>
            </button>
            <button class="menu-item" onclick="clearAllPhotos()">
                <span class="menu-icon">üóëÔ∏è</span>
                <span>Eliminar Fotos</span>
            </button>
            <button class="menu-item" onclick="shareReport()">
                <span class="menu-icon">üì§</span>
                <span>Compartir</span>
            </button>
            <button class="menu-item cancel" onclick="closeMenu()">
                <span class="menu-icon">‚úï</span>
                <span>Cancelar</span>
            </button>
        </div>
    </div>

    <!-- Modal de Configuraci√≥n -->
    <div id="settingsModal" class="modal">
        <div class="modal-content settings-modal">
            <div class="modal-header">
                <h2>‚öôÔ∏è Configuraci√≥n</h2>
                <button class="btn-close" onclick="closeSettings()">‚úï</button>
            </div>
            <div class="settings-content">
                <div class="setting-section">
                    <h3>üé® Personalizaci√≥n del PDF</h3>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Fotos por P√°gina</h4>
                            <p>M√°ximo de fotos permitidas por hoja</p>
                        </div>
                        <div class="setting-value">
                            <strong>12 fotos</strong>
                        </div>
                    </div>
                </div>

                <div class="setting-divider"></div>

                <div class="setting-section">
                    <h3>‚öôÔ∏è General</h3>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Modo Oscuro</h4>
                            <p>Tema oscuro para la interfaz</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Calidad de Compresi√≥n</h4>
                            <p>Mayor calidad = m√°s espacio</p>
                        </div>
                        <select id="qualitySelect" onchange="updateQuality()" class="quality-select">
                            <option value="0.6">Baja (ahorra espacio)</option>
                            <option value="0.8" selected>Media (recomendada)</option>
                            <option value="0.95">Alta (mejor calidad)</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Auto-guardar</h4>
                            <p>Guardar cambios autom√°ticamente</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="autoSaveToggle" checked onchange="toggleAutoSave()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Alineaci√≥n en PDF</h4>
                            <p>C√≥mo se centran las im√°genes</p>
                        </div>
                        <select id="pdfAlignmentSelect" onchange="updatePDFAlignment()" class="quality-select">
                            <option value="center">Centradas</option>
                            <option value="contain">Ajustar al espacio</option>
                            <option value="fill">Llenar espacio</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Plantilla PDF</h4>
                            <p>Estilo del PDF generado</p>
                        </div>
                        <select id="pdfTemplateSelect" onchange="updatePDFTemplate()" class="quality-select">
                            <option value="default">Est√°ndar</option>
                            <option value="professional">Profesional</option>
                            <option value="compact">Compacto</option>
                        </select>
                    </div>
                </div>
                
                <div class="setting-divider"></div>
                
                <button class="btn-danger" onclick="confirmClearAll()">
                    üóëÔ∏è Eliminar Todos los Reportes
                </button>
                
                <button class="btn-secondary" onclick="exportAllData()">
                    üíæ Exportar Todos los Datos
                </button>
                
                <button class="btn-secondary" onclick="document.getElementById('importInput').click()">
                    üì• Importar Datos
                </button>
                <input type="file" id="importInput" accept=".json" style="display: none;" onchange="importData(event)">
                
                <div class="app-info">
                    <p><strong>Reportes Fotogr√°ficos Pro v3.0</strong></p>
                    <p>‚ú® Hasta 12 fotos por p√°gina</p>
                    <p>üé® Encabezados y logos personalizables</p>
                    <p>üìù Pie de p√°gina editable</p>
                    <p>Almacenamiento usado: <span id="storageDetails">0 MB</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Carga -->
    <div id="loadingModal" class="modal loading-modal">
        <div class="loading-content">
            <div class="spinner"></div>
            <p id="loadingText">Procesando...</p>
        </div>
    </div>

    <!-- Modal de Vista Previa PDF MEJORADO -->
    <div id="pdfPreviewModal" class="modal">
        <div class="modal-content pdf-preview-content">
            <div class="modal-header">
                <h2>üìÑ Vista Previa PDF</h2>
                <button class="btn-close" onclick="closePDFPreview()">‚úï</button>
            </div>
            
            <!-- √Årea de vista previa con canvas -->
            <div id="pdfPreviewContainer" class="pdf-preview-container">
                <div class="pdf-info">
                    <p><strong>üìä Estad√≠sticas del PDF:</strong></p>
                    <p id="pdfStats">Generando vista previa...</p>
                </div>
                <div class="pdf-canvas-container" id="pdfCanvasContainer">
                    <!-- Los canvas se insertan aqu√≠ -->
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closePDFPreview()">Cancelar</button>
                <button class="btn-primary" onclick="downloadPDFFromPreview()">üì• Descargar PDF</button>
            </div>
        </div>
    </div>


    <!-- Modal de Tama√±os -->
    <div id="sizesModal" class="modal">
        <div class="modal-content menu-modal">
            <div class="modal-header">
                <h2>üî§ Tama√±os</h2>
                <button class="btn-close" onclick="closeSizesModal()">‚úï</button>
            </div>
            <div style="padding: 20px;">
                <div style="margin-bottom: 20px;">
                    <label style="display:block; font-weight:600; margin-bottom:8px;">T√≠tulo: <span id="titleSizeValue">14</span> pt</label>
                    <input type="range" id="titleSizeSlider" min="8" max="28" value="14" style="width:100%;" oninput="updateTitleSize()">
                    <div style="display:flex; justify-content:space-between; color:#999; font-size:12px;"><span>Peque√±o</span><span>Grande</span></div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display:block; font-weight:600; margin-bottom:8px;">Texto inferior: <span id="bottomSizeValue">8</span> pt</label>
                    <input type="range" id="bottomSizeSlider" min="5" max="16" value="8" style="width:100%;" oninput="updateBottomSize()">
                    <div style="display:flex; justify-content:space-between; color:#999; font-size:12px;"><span>Peque√±o</span><span>Grande</span></div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display:block; font-weight:600; margin-bottom:8px;">Logo: <span id="logoSizeValue">20</span> mm</label>
                    <input type="range" id="logoSizeSlider" min="8" max="40" value="20" style="width:100%;" oninput="updateLogoSize()">
                    <div style="display:flex; justify-content:space-between; color:#999; font-size:12px;"><span>Peque√±o</span><span>Grande</span></div>
                </div>
                <button class="btn-primary" onclick="closeSizesModal()" style="margin-top:10px;">Guardar</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="app.js"></script>
</body>
</html>